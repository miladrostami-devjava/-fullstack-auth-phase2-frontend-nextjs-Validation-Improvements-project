
import React, { useEffect, useState } from "react";

function ProfilePhoto({ filename, token }: { filename: string; token: string | null }) {
    const [photoSrc, setPhotoSrc] = useState<string>("");

    useEffect(() => {
        if (!filename || !token) return;

        // درخواست عکس با axios یا fetch و ارسال هدر Authorization
        fetch(`http://localhost:9090/api/profile/photo/${filename}`, {
            headers: {
                Authorization: `Bearer ${token}`,
            },
        })
            .then((res) => {
                if (!res.ok) throw new Error("Failed to fetch image");
                return res.blob();
            })
            .then((blob) => {
                // ساخت URL محلی برای عکس
                const url = URL.createObjectURL(blob);
                setPhotoSrc(url);
            })
            .catch((err) => {
                console.error(err);
                setPhotoSrc(""); // یا یک عکس پیش‌فرض بگذارید
            });

        // آزادسازی URL زمانی که کامپوننت از بین می‌رود
        return () => {
            if (photoSrc) URL.revokeObjectURL(photoSrc);
        };
    }, [filename, token]);

    if (!photoSrc) return <div>Loading photo...</div>;

    return (
        <img
            src={photoSrc}
            alt="Profile"
            className="w-32 h-32 object-cover rounded-full border mt-2"
        />
    );
}
